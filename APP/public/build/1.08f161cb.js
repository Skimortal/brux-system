"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1],{70001:(e,n,t)=>{t.r(n),t.d(n,{bootDashboard:()=>G});t(52675),t(89463),t(2259),t(16280),t(76918),t(28706),t(51629),t(23418),t(74423),t(64346),t(23792),t(48598),t(62062),t(44114),t(34782),t(59089),t(1688),t(60739),t(23288),t(62010),t(33110),t(5506),t(26099),t(3362),t(27495),t(90906),t(38781),t(99449),t(21699),t(47764),t(11392),t(50375),t(42762),t(98992),t(3949),t(81454),t(23500),t(62953),t(76031),t(47154);var a=t(67363),i=t(97950),o=t(90666),c=t(38680),r=t(39612),l=t(89336),d=t(95093),s=t.n(d),u=t(41661);function m(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,i,o,c,r=[],l=!0,d=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;l=!1}else for(;!(l=(a=o.call(t)).done)&&(r.push(a.value),r.length!==n);l=!0);}catch(e){d=!0,i=e}finally{try{if(!l&&null!=t.return&&(c=t.return(),Object(c)!==c))return}finally{if(d)throw i}}return r}}(e,n)||function(e,n){if(e){if("string"==typeof e)return v(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?v(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}var h,p,y,f,b=new Date,g=[],k=null,E="global",I={bar:"Bar",setup:"Aufbau",teardown:"Abbau",ticketing:"Ticketing",cleanup:"Aufräumen",other:"Anderes"};var w=null,B=null;function T(){var e=document.getElementById("appointmentModal");e&&(h=new l.aF(e));var n=document.getElementById("productionEventModal");n&&(p=new l.aF(n));var t=document.getElementById("deleteConfirmModal");t&&(f=new l.aF(t)),g.forEach(function(e){return e.destroy()}),g=[],k&&(k.destroy(),k=null),document.querySelectorAll(".filter-checkbox").forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("change",x)}),document.querySelectorAll('input[name="calendarView"]').forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("change",function(){var e,n,t;E=this.value,e=this.value,n=document.getElementById("globalCalendarContainer"),t=document.getElementById("roomCalendarsContainer"),"global"===e?(n&&(n.style.display="block"),t&&(t.style.display="none"),k&&(k.updateSize(),k.refetchEvents())):(n&&(n.style.display="none"),t&&(t.style.display="block"),g.forEach(function(e){e.updateSize(),e.refetchEvents()}))})});var d=document.getElementById("syncApiBtn");if(d){var s=d.cloneNode(!0);d.parentNode.replaceChild(s,d),s.addEventListener("click",S)}var u=window.innerWidth<=767;!function(e){var n=document.getElementById("global-calendar");if(!n)return;k=new a.Vv(n,{plugins:[i.A,o.A,c.Ay],initialView:e?"timeGridWeek":"dayGridMonth",locale:r.A,timeZone:"Europe/Berlin",firstDay:1,headerToolbar:e?{left:"prev,next",center:"title",right:"today,dayGridMonth,timeGridWeek,timeGridDay"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},slotMinTime:"08:00:00",slotMaxTime:"22:00:00",allDaySlot:!0,height:1e3,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1,meridiem:!1},eventDisplay:"block",eventContent:function(e){var n=e.event.title||"",t=document.createElement("div");return t.className="fc-event-title-container",t.innerHTML=n,{domNodes:[t]}},events:function(e,n,t){var a=Array.from(document.querySelectorAll(".filter-checkbox:checked")).map(function(e){return e.value}).join(","),i="/dashboard/events?roomId=&start=".concat(e.startStr,"&end=").concat(e.endStr,"&filters=").concat(a);fetch(i).then(function(e){return e.json()}).then(function(e){return n(e)}).catch(function(e){console.error("Error loading events:",e),t(e)})},dateClick:function(e){H(e.dateStr,null,e.date,null)},eventClick:function(e){A(e)},eventDidMount:function(e){var n=new Date;(e.event.end||e.event.start)<n&&(e.el.style.opacity="0.5",e.el.style.textDecoration="line-through")},editable:!1}),k.render()}(u),function(e){document.querySelectorAll(".room-calendar").forEach(function(n){var t=function(e,n){var t=e.dataset.roomId||"",l=new a.Vv(e,{plugins:[i.A,o.A,c.Ay],initialView:n?"timeGridWeek":"dayGridMonth",locale:r.A,timeZone:"Europe/Berlin",firstDay:1,headerToolbar:n?{left:"prev,next",center:"title",right:"today,dayGridMonth,timeGridWeek,timeGridDay"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},slotMinTime:"08:00:00",slotMaxTime:"22:00:00",allDaySlot:!0,height:1e3,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1,meridiem:!1},eventDisplay:"block",eventContent:function(e){var n=e.event.title||"",t=document.createElement("div");return t.className="fc-event-title-container",t.innerHTML=n,{domNodes:[t]}},events:function(e,n,a){var i=Array.from(document.querySelectorAll(".filter-checkbox:checked")).map(function(e){return e.value}).join(","),o="/dashboard/events?roomId=".concat(t,"&start=").concat(e.startStr,"&end=").concat(e.endStr,"&filters=").concat(i);fetch(o).then(function(e){return e.json()}).then(function(e){return n(e)}).catch(function(e){console.error("Error loading events:",e),a(e)})},dateClick:function(e){H(e.dateStr,null,e.date,t)},eventClick:function(e){A(e)},eventDidMount:function(e){var n=new Date;(e.event.end||e.event.start)<n&&(e.el.style.opacity="0.5",e.el.style.textDecoration="line-through")},editable:!1,datesSet:function(e){!function(e){if(e._isSyncing)return;g.forEach(function(n){if(n!==e){n._isSyncing=!0;var t=e.view.type,a=e.getDate();n.view.type!==t&&n.changeView(t),n.gotoDate(a),setTimeout(function(){n._isSyncing=!1},100)}})}(l)}});return l.render(),l}(n,e);g.push(t)})}(u),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){(function(e){b=new Date(e);var n=e.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),t=e.toLocaleDateString("de-DE",{weekday:"long"}),a=document.getElementById("day-number-text");a&&(a.textContent=n);var i=document.getElementById("day-suffix");i&&(i.textContent="");var o=document.getElementById("day-name");o&&(o.textContent=t.charAt(0).toUpperCase()+t.slice(1))})(b)}).catch(function(e){return console.error(e)}),function(){var e=document.getElementById("saveAppointmentBtn");if(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",j)}var t=document.getElementById("duplicateAppointmentBtn");if(t){var a=t.cloneNode(!0);t.parentNode.replaceChild(a,t),a.addEventListener("click",function(){B&&H(null,B,null,null,"duplicate")})}var i=document.getElementById("deleteAppointmentBtn");if(i){var o=i.cloneNode(!0);i.parentNode.replaceChild(o,i),o.addEventListener("click",function(){!function(e){w=e;var n=document.getElementById("deleteConfirmMessage"),t=document.getElementById("deleteRecurringOptions");e?(t.style.display="block",n.textContent="Möchten Sie diesen Termin löschen?"):(t.style.display="none",n.textContent="Möchten Sie diesen Termin wirklich löschen?");f&&f.show()}(document.getElementById("appointmentId").value)})}var c=document.getElementById("confirmDeleteBtn");if(c){var r=c.cloneNode(!0);c.parentNode.replaceChild(r,c),r.addEventListener("click",_)}var l=document.getElementById("appointmentAllDay");if(l){var d=l.cloneNode(!0);l.parentNode.replaceChild(d,l),d.addEventListener("change",R)}var s=document.getElementById("appointmentRecurring");if(s){var u=s.cloneNode(!0);s.parentNode.replaceChild(u,s),u.addEventListener("change",M)}document.querySelectorAll(".appointment-type-radio").forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("change",L)});var m=document.getElementById("add-appointment-btn");if(m){var v=m.cloneNode(!0);m.parentNode.replaceChild(v,m),v.addEventListener("click",function(){H(b.toISOString().split("T")[0])})}}()}function S(){var e=document.getElementById("syncApiBtn");if(e){var n=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="ti-reload spin"></i> Synchronisiere...';var t=document.createElement("style");t.textContent="\n        .spin {\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin {\n            from { transform: rotate(0deg); }\n            to { transform: rotate(360deg); }\n        }\n    ",document.querySelector("style[data-sync-spinner]")||(t.setAttribute("data-sync-spinner","true"),document.head.appendChild(t)),fetch("/dashboard/sync-api",{method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){e.disabled=!1,e.innerHTML=n,t.success?(D("success",t.message),x(),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){0})):D("error",t.message||"Fehler bei der Synchronisation")}).catch(function(t){e.disabled=!1,e.innerHTML=n,console.error("Sync error:",t),D("error","Netzwerkfehler bei der Synchronisation")})}}function D(e,n){var t=document.createElement("div");t.className="alert alert-".concat("success"===e?"success":"danger"," alert-dismissible fade show position-fixed"),t.style.cssText="top: 20px; right: 20px; z-index: 9999; max-width: 400px;",t.innerHTML="\n        ".concat(n,'\n        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    '),document.body.appendChild(t),setTimeout(function(){t.remove()},5e3)}function x(){"global"===E?k&&k.refetchEvents():g.forEach(function(e){return e.refetchEvents()})}function C(){x()}function A(e){var n=e.event.extendedProps.type;if("production_event"===n){var t=e.event.extendedProps.productionEventId;t&&function(e){var n=document.getElementById("productionEventModalBody"),t=document.getElementById("productionEventModalTitle"),a=document.getElementById("editProductionEventBtn");if(!p)return;n.innerHTML='\n        <div class="text-center p-5">\n            <div class="spinner-border text-primary" role="status">\n                <span class="visually-hidden">Laden...</span>\n            </div>\n        </div>\n    ',p.show(),fetch("/dashboard/production-event/".concat(e,"/details")).then(function(e){return e.json()}).then(function(e){if(e.error)n.innerHTML='<div class="alert alert-danger">'.concat(e.error,"</div>");else{var i=e.event,o=e.production;t.textContent=o?o.title:"Veranstaltung",a&&(a.href="/production-event/".concat(i.id,"/edit"),a.style.display="inline-block");var c="";if(o&&o.postThumbnailUrl&&(c+='\n                    <div class="text-center mb-4">\n                        <img src="'.concat(o.postThumbnailUrl,'"\n                             alt="').concat(o.title,'"\n                             class="img-fluid rounded"\n                             style="max-height: 300px; object-fit: cover;">\n                    </div>\n                ')),c+='<div class="row mb-4">',c+='<div class="col-md-6">',c+='<h6 class="text-muted mb-3">Veranstaltungsinformationen</h6>',i.date&&(c+='\n                    <div class="mb-2">\n                        <strong><i class="ti-calendar me-2"></i>Datum:</strong>\n                        '.concat(i.date,"\n                    </div>\n                ")),i.timeFrom&&(c+='\n                    <div class="mb-2">\n                        <strong><i class="ti-time me-2"></i>Uhrzeit:</strong>\n                        '.concat(i.timeFrom).concat(i.timeTo?" - "+i.timeTo:""," Uhr\n                    </div>\n                ")),i.room&&(c+='\n                    <div class="mb-2">\n                        <strong><i class="ti-location-pin me-2"></i>Raum:</strong>\n                        '.concat(i.room,"\n                    </div>\n                ")),i.status){var r=i.status.includes("Aktiv")?"success":"secondary";c+='\n                    <div class="mb-2">\n                        <strong>Status:</strong>\n                        <span class="badge bg-'.concat(r,'">').concat(i.status,"</span>\n                    </div>\n                ")}var l=Array.isArray(i.productionContactPersons)?i.productionContactPersons:[],d=Array.isArray(i.assignedContactPersonIds)?i.assignedContactPersonIds:[];if(l.length>0){var s=l.map(function(e){var n=[e.name];e.email&&n.push(e.email),e.phone&&n.push(e.phone);var t=n.join(" • "),a=d.includes(e.id)?"selected":"";return'<option value="'.concat(e.id,'" ').concat(a,">").concat(t,"</option>")}).join("");c+='\n                    <div class="mb-2">\n                        <strong>Ansprechpartner:</strong>\n                        <select\n                            id="productionEventContactPersons"\n                            class="form-select tom-select"\n                            multiple\n                            data-placeholder="Bitte auswählen"\n                        >\n                            '.concat(s,'\n                        </select>\n                        <small class="text-muted d-block mt-1">\n                            Zuordnung gilt für dieses Event.\n                        </small>\n                    </div>\n                ')}else c+='\n                    <div class="mb-2">\n                        <strong>Ansprechpartner:</strong>\n                        <div class="text-muted">Keine Ansprechpartner in der Produktion hinterlegt.</div>\n                    </div>\n                ';if(c+="</div>",c+='<div class="col-md-6">',c+='<h6 class="text-muted mb-3">Plätze & Reservierungen</h6>',null!==i.quota&&(c+='\n                    <div class="mb-2">\n                        <strong><i class="ti-package me-2"></i>Kontingent:</strong>\n                        '.concat(i.quota," Plätze\n                    </div>\n                ")),null!==i.incomingTotal&&(c+='\n                    <div class="mb-2">\n                        <strong><i class="ti-check me-2"></i>Reserviert:</strong>\n                        '.concat(i.incomingTotal,"\n                    </div>\n                ")),null!==i.freeSeats){var u=i.freeSeats>10?"success":i.freeSeats>0?"warning":"danger";c+='\n                    <div class="mb-2">\n                        <strong><i class="ti-ticket me-2"></i>Frei:</strong>\n                        <span class="badge bg-'.concat(u,'">').concat(i.freeSeats,"</span>\n                    </div>\n                ")}if(c+="</div>",c+="</div>",i.prices&&i.prices.length>0&&(c+='\n                    <div class="mb-4">\n                        <h6 class="text-muted mb-3">Preise</h6>\n                        <div class="table-responsive">\n                            <table class="table table-sm table-bordered">\n                                <thead class="table-light">\n                                    <tr>\n                                        <th>Kategorie</th>\n                                        <th>Preis</th>\n                                        <th>Reservierungen</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                ',i.prices.forEach(function(e){c+="\n                        <tr>\n                            <td>".concat(e.categoryLabel||"-","</td>\n                            <td><strong>").concat(e.priceLabel||"0","€</strong></td>\n                            <td>").concat(e.incomingReservations||0,"</td>\n                        </tr>\n                    ")}),c+="\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                "),i.categories&&i.categories.length>0&&(c+='\n                    <div class="mb-4">\n                        <h6 class="text-muted mb-2">Hinweise</h6>\n                        <div>\n                ',i.categories.forEach(function(e){var n="ausverkauft-event"===e.slug?"danger":"info";c+='<span class="badge bg-'.concat(n,' me-2">').concat(e.name,"</span>")}),c+="\n                        </div>\n                    </div>\n                "),i.reservationNote){var m=i.reservationNote.startsWith("http");c+='\n                    <div class="mb-4">\n                        <h6 class="text-muted mb-2">Reservierung</h6>\n                        '.concat(m?'<a href="'.concat(i.reservationNote,'" target="_blank" class="btn btn-sm btn-primary">\n                                <i class="ti-new-window me-1"></i>Zur Reservierung\n                            </a>'):'<p class="mb-0">'.concat(i.reservationNote,"</p>"),"\n                    </div>\n                ")}o&&o.contentHtml&&(c+='\n                    <div class="mt-4 pt-4 border-top">\n                        <h6 class="text-muted mb-3">Über die Produktion</h6>\n                        <div class="production-content">\n                            '.concat(o.contentHtml,"\n                        </div>\n                    </div>\n                ")),o&&o.permalink&&(c+='\n                    <div class="mt-3">\n                        <a href="'.concat(o.permalink,'" target="_blank" class="btn btn-sm btn-secondary">\n                            <i class="ti-link me-1"></i>Zur Website\n                        </a>\n                    </div>\n                ')),n.innerHTML=c,window.initTomSelect&&window.initTomSelect();var v=document.getElementById("productionEventContactPersons");v&&v.addEventListener("change",function(){var e=Array.from(v.selectedOptions).map(function(e){return e.value});fetch("/dashboard/production-event/".concat(i.id,"/contact-persons"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactPersonIds:e})}).then(function(e){return e.json()}).then(function(e){e&&e.success?D("success","Ansprechpartner gespeichert"):D("error",e&&e.message?e.message:"Speichern fehlgeschlagen")}).catch(function(){D("error","Netzwerkfehler beim Speichern")})})}}).catch(function(e){console.error("Error loading event details:",e),n.innerHTML='\n                <div class="alert alert-danger">\n                    Fehler beim Laden der Event-Details.\n                </div>\n            '})}(t)}else if("key"===n){var a=e.event.extendedProps.keyId;a&&F(a)}else["private","cleaning","production"].includes(n)?H(null,e.event):alert(e.event.title+"\n"+(e.event.extendedProps.description||""))}function M(e){var n=document.getElementById("recurrenceOptions"),t=document.getElementById("recurrenceEndDate");n&&(n.style.display=e.target.checked?"block":"none"),e.target.checked&&t&&(0,u.qR)(t,"singleDate"),!e.target.checked&&t&&(t.value="")}function L(){var e=document.querySelector('input[name="appointmentType"]:checked');if(e){var n,t=e.value,a=document.getElementById("typeSpecificFields");if(a)switch(a.innerHTML="",function(e){var n=document.getElementById("appointmentTitle");if(!n)return;var t=n.closest(".mb-3"),a="production"===e||"cleaning"===e;t&&(t.style.display=a?"none":"block");n.required=!a,a&&(n.value="")}(t),t){case"private":break;case"production":a.innerHTML=function(){var e=window.dashboardData.allProductions||[];window.dashboardData.allTechnicians,window.dashboardData.allVolunteers;return'\n        <div class="border-top pt-3 mt-3">\n            <h6 class="fw-bold mb-3">Produktions-Details</h6>\n\n            <div class="mb-3">\n                <label for="productionSelect" class="form-label">Produktion</label>\n                <select class="form-select" id="productionSelect">\n                    <option value="">Bitte wählen...</option>\n                    '.concat(e.map(function(e){return'<option value="'.concat(e.id,'">').concat(e.title||e.displayName,"</option>")}).join(""),'\n                </select>\n            </div>\n\n            <div class="mb-3">\n                <label class="form-label d-block">Ereignisart</label>\n                <div class="btn-group w-100" role="group">\n                    <input type="radio" class="btn-check" name="eventType" id="eventTypeRehearsal" value="rehearsal">\n                    <label class="btn btn-outline-secondary" for="eventTypeRehearsal">\n                        <i class="ti-music-alt"></i> Probe\n                    </label>\n\n                    <input type="radio" class="btn-check" name="eventType" id="eventTypeSetup" value="setup_teardown">\n                    <label class="btn btn-outline-secondary" for="eventTypeSetup">\n                        <i class="ti-package"></i> Aufbau/Abbau\n                    </label>\n\n                    <input type="radio" class="btn-check" name="eventType" id="eventTypeEvent" value="event">\n                    <label class="btn btn-outline-secondary" for="eventTypeEvent">\n                        <i class="ti-flag-alt"></i> Veranstaltung\n                    </label>\n                </div>\n            </div>\n\n            <div class="mb-3">\n                <label class="form-label">Status</label>\n                <div class="btn-group w-100" role="group">\n                    <input type="radio" class="btn-check" name="appointmentStatus" id="statusReserved" value="reserved">\n                    <label class="btn btn-outline-warning" for="statusReserved">Reserviert</label>\n\n                    <input type="radio" class="btn-check" name="appointmentStatus" id="statusConfirmed" value="confirmed">\n                    <label class="btn btn-outline-success" for="statusConfirmed">Fix</label>\n                </div>\n            </div>\n\n            <div class="mb-3 form-check">\n                <input type="checkbox" class="form-check-input" id="internalTechniciansAttending">\n                <label class="form-check-label" for="internalTechniciansAttending">\n                    Interne Techniker kommen\n                </label>\n            </div>\n\n            <div class="mb-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignTechniciansCheckbox">\n                    <label class="form-check-label fw-bold" for="assignTechniciansCheckbox">\n                        Techniker zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="techniciansContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 50%;">Techniker</th>\n                            <th style="width: 25%;">Bestätigt</th>\n                            <th style="width: 25%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="techniciansList">\n                    </tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addTechnicianBtn">\n                    <i class="ti-plus"></i> Techniker hinzufügen\n                </button>\n            </div>\n\n            <div class="mb-3 mt-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignVolunteersCheckbox">\n                    <label class="form-check-label fw-bold" for="assignVolunteersCheckbox">\n                        Volunteers zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="volunteersContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 35%;">Volunteer</th>\n                            <th style="width: 20%;">Bestätigt</th>\n                            <th style="width: 35%;">Aufgaben</th>\n                            <th style="width: 10%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="volunteersList">\n                    </tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addVolunteerBtn">\n                    <i class="ti-plus"></i> Volunteer hinzufügen\n                </button>\n            </div>\n        </div>\n    ')}(),N();break;case"closed_event":a.innerHTML=P("Veranstaltungs-Details"),N();break;case"school_event":a.innerHTML=P("Schulveranstaltung"),N();break;case"internal":a.innerHTML=P("Interner Termin"),N();break;case"cleaning":a.innerHTML=(n=window.dashboardData.allCleanings||[],'\n        <div class="border-top pt-3 mt-3">\n            <h6 class="fw-bold mb-3">Reinigungs-Details</h6>\n\n            <div class="mb-3">\n                <label for="cleaningSelect" class="form-label">Reinigung</label>\n                <select class="form-select" id="cleaningSelect">\n                    <option value="">Bitte wählen...</option>\n                    '.concat(n.map(function(e){return'<option value="'.concat(e.id,'">').concat(e.name,"</option>")}).join(""),"\n                </select>\n            </div>\n        </div>\n    "))}}}function P(e){return'\n        <div class="border-top pt-3 mt-3">\n            <h6 class="fw-bold mb-3">'.concat(e,'</h6>\n\n            <div class="mb-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignTechniciansCheckbox">\n                    <label class="form-check-label fw-bold" for="assignTechniciansCheckbox">\n                        Techniker zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="techniciansContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 50%;">Techniker</th>\n                            <th style="width: 25%;">Bestätigt</th>\n                            <th style="width: 25%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="techniciansList"></tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addTechnicianBtn">\n                    <i class="ti-plus"></i> Techniker hinzufügen\n                </button>\n            </div>\n\n            <div class="mb-3 mt-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignVolunteersCheckbox">\n                    <label class="form-check-label fw-bold" for="assignVolunteersCheckbox">\n                        Volunteers zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="volunteersContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 35%;">Volunteer</th>\n                            <th style="width: 20%;">Bestätigt</th>\n                            <th style="width: 35%;">Aufgaben</th>\n                            <th style="width: 10%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="volunteersList"></tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addVolunteerBtn">\n                    <i class="ti-plus"></i> Volunteer hinzufügen\n                </button>\n            </div>\n        </div>\n    ')}function N(){var e=document.getElementById("assignTechniciansCheckbox"),n=document.getElementById("techniciansContainer"),t=document.getElementById("addTechnicianBtn");e&&n&&e.addEventListener("change",function(){n.style.display=this.checked?"block":"none"}),t&&t.addEventListener("click",q);var a=document.getElementById("assignVolunteersCheckbox"),i=document.getElementById("volunteersContainer"),o=document.getElementById("addVolunteerBtn");a&&i&&a.addEventListener("change",function(){i.style.display=this.checked?"block":"none"}),o&&o.addEventListener("click",Y)}function q(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=window.dashboardData.allTechnicians||[],t=document.getElementById("techniciansList");if(t){var a=document.createElement("tr"),i="tech_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);a.dataset.rowId=i,a.innerHTML='\n        <td>\n            <select class="form-select form-select-sm technician-select" data-row-id="'.concat(i,'">\n                <option value="">Wählen...</option>\n                ').concat(n.map(function(n){return'\n                    <option value="'.concat(n.id,'" ').concat(e&&e.id==n.id?"selected":"",">\n                        ").concat(n.name,"\n                    </option>\n                ")}).join(""),'\n            </select>\n        </td>\n        <td class="text-center">\n            <input type="checkbox" class="form-check-input technician-confirmed"\n                   data-row-id="').concat(i,'"\n                   ').concat(e&&e.confirmed?"checked":"",'>\n        </td>\n        <td class="text-center">\n            <button type="button" class="btn btn-sm btn-danger remove-technician-btn" data-row-id="').concat(i,'">\n                <i class="ti-trash"></i>\n            </button>\n        </td>\n    '),t.appendChild(a),a.querySelector(".remove-technician-btn").addEventListener("click",function(){a.remove()})}}function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=window.dashboardData.allVolunteers||[],t=document.getElementById("volunteersList");if(t){var a=document.createElement("tr"),i="vol_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);a.dataset.rowId=i;var o=Object.entries(I).map(function(n){var t=m(n,2),a=t[0],o=t[1],c=e&&e.tasks&&e.tasks.includes(a)?"checked":"";return'\n            <div class="form-check form-check-inline">\n                <input class="form-check-input volunteer-task" type="checkbox"\n                       value="'.concat(a,'"\n                       data-row-id="').concat(i,'"\n                       ').concat(c,'>\n                <label class="form-check-label" style="font-size: 0.85rem;">').concat(o,"</label>\n            </div>\n        ")}).join("");a.innerHTML='\n        <td>\n            <select class="form-select form-select-sm volunteer-select" data-row-id="'.concat(i,'">\n                <option value="">Wählen...</option>\n                ').concat(n.map(function(n){return'\n                    <option value="'.concat(n.id,'" ').concat(e&&e.id==n.id?"selected":"",">\n                        ").concat(n.name,"\n                    </option>\n                ")}).join(""),'\n            </select>\n        </td>\n        <td class="text-center">\n            <input type="checkbox" class="form-check-input volunteer-confirmed"\n                   data-row-id="').concat(i,'"\n                   ').concat(e&&e.confirmed?"checked":"",">\n        </td>\n        <td>\n            ").concat(o,'\n        </td>\n        <td class="text-center">\n            <button type="button" class="btn btn-sm btn-danger remove-volunteer-btn" data-row-id="').concat(i,'">\n                <i class="ti-trash"></i>\n            </button>\n        </td>\n    '),t.appendChild(a),a.querySelector(".remove-volunteer-btn").addEventListener("click",function(){a.remove()})}}function H(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"edit",o=document.getElementById("appointmentModalLabel"),c=document.getElementById("deleteAppointmentBtn"),r=document.getElementById("duplicateAppointmentBtn"),l=document.getElementById("appointmentRoom"),d=document.getElementById("appointmentTitle"),m=document.getElementById("appointmentDescription"),v=document.getElementById("appointmentDateRange"),p=document.getElementById("appointmentAllDay"),y=document.getElementById("appointmentRecurring");B=null,l&&(l.value=""),d&&(d.value=""),m&&(m.value=""),p&&(p.checked=!1),y&&(y.checked=!1),document.getElementById("recurrenceOptions").style.display="none",r&&(r.style.display="none");var f=document.getElementById("typePrivate");f&&(f.checked=!0,L());var b=(0,u.qR)(v,"dateTimeRange");if(n){var g,k,E;B=n;var I="duplicate"===i;I?(o.textContent="Termin duplizieren",c&&(c.style.display="none")):(o.textContent="Termin bearbeiten",c&&(c.style.display="inline-block"),r&&(r.style.display="inline-block"));var w=String(n.id),T=w;w.includes("_")&&(T=w.split("_")[1]),document.getElementById("appointmentId").value=I?"":T;var S=(null===(g=n.extendedProps)||void 0===g?void 0:g.originalTitle)||n.title;d&&(d.value=I?function(e){var n=(e||"").trim();return n?n.endsWith(" (Kopie)")?n:"".concat(n," (Kopie)"):""}(S):S),m&&(m.value=(null===(k=n.extendedProps)||void 0===k?void 0:k.description)||""),n.extendedProps&&n.extendedProps.roomId&&l&&(l.value=n.extendedProps.roomId);var D=(null===(E=n.extendedProps)||void 0===E?void 0:E.appointmentType)||"private",x=document.querySelector('input[name="appointmentType"][value="'.concat(D,'"]'));x&&(x.checked=!0,L());var C=s()(n.start),A=s()(n.end||n.start);n.allDay&&A.subtract(1,"days"),b.setStartDate(C),b.setEndDate(A),p&&(p.checked=n.allDay),R({target:{checked:n.allDay}}),setTimeout(function(){!function(e){var n,t=null===(n=e.extendedProps)||void 0===n?void 0:n.appointmentType;if("production"===t||"closed_event"===t){var a,i,o,c,r;if("production"===t&&null!==(a=e.extendedProps)&&void 0!==a&&a.productionId){var l=document.getElementById("productionSelect");l&&(l.value=e.extendedProps.productionId)}if(null!==(i=e.extendedProps)&&void 0!==i&&i.eventType){var d=document.querySelector('input[name="eventType"][value="'.concat(e.extendedProps.eventType,'"]'));d&&(d.checked=!0)}if(null!==(o=e.extendedProps)&&void 0!==o&&o.status){var s=document.querySelector('input[name="appointmentStatus"][value="'.concat(e.extendedProps.status,'"]'));s&&(s.checked=!0)}var u,m=document.getElementById("internalTechniciansAttending");if(m)m.checked=(null===(u=e.extendedProps)||void 0===u?void 0:u.internalTechniciansAttending)||!1;if(null!==(c=e.extendedProps)&&void 0!==c&&c.technicians&&e.extendedProps.technicians.length>0){var v=document.getElementById("assignTechniciansCheckbox");v&&(v.checked=!0,v.dispatchEvent(new Event("change"))),setTimeout(function(){e.extendedProps.technicians.forEach(function(e){q(e)})},100)}if(null!==(r=e.extendedProps)&&void 0!==r&&r.volunteers&&e.extendedProps.volunteers.length>0){var h=document.getElementById("assignVolunteersCheckbox");h&&(h.checked=!0,h.dispatchEvent(new Event("change"))),setTimeout(function(){e.extendedProps.volunteers.forEach(function(e){Y(e)})},100)}}else if("cleaning"===t){var p;if(null!==(p=e.extendedProps)&&void 0!==p&&p.cleaningId){var y=document.getElementById("cleaningSelect");y&&(y.value=e.extendedProps.cleaningId)}}}(n)},100)}else{var M,P;o.textContent="Neuer Termin",c&&(c.style.display="none"),document.getElementById("appointmentId").value="",a&&l&&(l.value=a),t?(M=s()(t),P=s()(t).add(1,"hours"),p&&(p.checked=!1)):((M=e?s()(e):s()()).hours(9).minutes(0).seconds(0),P=s()(M).add(1,"hours"),p&&(p.checked=!1)),b.setStartDate(M),b.setEndDate(P),R({target:{checked:!1}})}h&&h.show()}function R(e){var n=document.getElementById("appointmentDateRange");if(n){var t=(0,u.IQ)(n);if(t){if(e.target.checked){var a=t.startDate,i=t.endDate;t.timePicker=!1,t.locale.format="DD.MM.YYYY",t.setStartDate(a.startOf("day")),t.setEndDate(i.startOf("day"))}else t.timePicker=!0,t.timePicker24Hour=!0,t.timePickerIncrement=15,t.locale.format="DD.MM.YYYY HH:mm";t.updateView()}}}function j(){var e=document.getElementById("appointmentId").value,n=document.getElementById("appointmentTitle").value,t=document.getElementById("appointmentDescription").value,a=document.getElementById("appointmentRoom")?document.getElementById("appointmentRoom").value:null,i=document.querySelector('input[name="appointmentType"]:checked'),o=i?i.value:"private";if(!n&&("production"===o||"cleaning"===o))if("production"===o){var c=document.getElementById("productionSelect");n=(c&&c.selectedOptions&&c.selectedOptions[0]?c.selectedOptions[0].textContent.trim():"")||"Produktion"}else if("cleaning"===o){var r=document.getElementById("cleaningSelect");n=(r&&r.selectedOptions&&r.selectedOptions[0]?r.selectedOptions[0].textContent.trim():"")||"Reinigung"}if(n||"production"===o||"cleaning"===o){var l=document.getElementById("appointmentAllDay").checked,d=document.getElementById("appointmentDateRange"),s=(0,u.IQ)(d);if(s&&s.startDate&&s.endDate){var m,v,p=s.startDate,y=s.endDate;l?(m=p.format("YYYY-MM-DD")+"T00:00:00",v=y.clone().add(1,"days").format("YYYY-MM-DD")+"T00:00:00"):(m=p.format("YYYY-MM-DDTHH:mm:ss"),v=y.format("YYYY-MM-DDTHH:mm:ss"));var f={title:n,description:t,start:m,end:v,allDay:l,roomId:a,type:o};if("production"===o){var b=document.getElementById("productionSelect");f.productionId=b?b.value:null;var g=document.querySelector('input[name="eventType"]:checked');f.eventType=g?g.value:null;var k=document.querySelector('input[name="appointmentStatus"]:checked');f.status=k?k.value:null;var E=document.getElementById("internalTechniciansAttending");f.internalTechniciansAttending=!!E&&E.checked,f.technicians=V(),f.volunteers=O()}else if("closed_event"===o||"school_event"===o||"internal"===o)f.technicians=V(),f.volunteers=O(),f.eventType=null,f.status=null,f.internalTechniciansAttending=!1;else if("cleaning"===o){var I=document.getElementById("cleaningSelect");f.cleaningId=I?I.value:null}var w=document.getElementById("appointmentRecurring");if(w&&w.checked){var B=document.getElementById("recurrenceFrequency"),T=document.getElementById("recurrenceEndDate");if(B&&(f.recurrenceFrequency=B.value),T){var S=(0,u.IQ)(T)||(0,u.qR)(T,"singleDate");S&&S.startDate&&(f.recurrenceEndDate=S.startDate.format("YYYY-MM-DD"))}if(!f.recurrenceEndDate)return void alert("Bitte geben Sie ein Enddatum für die Wiederholung an.")}var x=e?"/appointment/".concat(e,"/edit"):"/appointment/create";fetch(x,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}).then(function(e){return e.json()}).then(function(e){e.success?(h.hide(),C(),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){0}),D("success","Termin erfolgreich gespeichert")):alert("Fehler beim Speichern: "+(e.message||"Unbekannter Fehler"))}).catch(function(e){console.error(e),alert("Fehler beim Speichern.")})}else alert("Bitte wählen Sie einen Zeitraum aus.")}else alert("Bitte geben Sie einen Titel ein.")}function V(){var e=document.querySelectorAll("#techniciansList tr"),n=[];return e.forEach(function(e){var t=e.dataset.rowId,a=e.querySelector('.technician-select[data-row-id="'.concat(t,'"]')),i=e.querySelector('.technician-confirmed[data-row-id="'.concat(t,'"]'));a&&a.value&&n.push({id:a.value,confirmed:!!i&&i.checked})}),n}function O(){var e=document.querySelectorAll("#volunteersList tr"),n=[];return e.forEach(function(e){var t=e.dataset.rowId,a=e.querySelector('.volunteer-select[data-row-id="'.concat(t,'"]')),i=e.querySelector('.volunteer-confirmed[data-row-id="'.concat(t,'"]')),o=e.querySelectorAll('.volunteer-task[data-row-id="'.concat(t,'"]:checked'));if(a&&a.value){var c=Array.from(o).map(function(e){return e.value});n.push({id:a.value,confirmed:!!i&&i.checked,tasks:c})}}),n}function _(){if(w){var e=document.querySelector('input[name="deleteMode"]:checked'),n=e?e.value:"single",t=String(w),a=t;t.includes("_")&&(a=t.split("_")[1]),fetch("/appointment/".concat(a,"/delete"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:n})}).then(function(e){return e.json()}).then(function(e){e.success?(f&&f.hide(),h&&h._isShown&&h.hide(),C(),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){0}),D("success","Termin erfolgreich gelöscht")):alert("Fehler beim Löschen.")}).catch(function(e){console.error(e),alert("Fehler beim Löschen.")})}}function F(e){var n=document.querySelector('.key-item-btn[data-key-id="'.concat(e,'"]'));n||(n=e);var t=n.dataset.keyId,a=n.dataset.keyName,i=n.dataset.keyStatus,o=document.getElementById("keyId");o&&(o.value=t);var c=document.getElementById("modalKeyNameTitle");c&&(c.textContent=a);var r=document.getElementById("keyStatus");r&&(r.value=i,r.dispatchEvent(new Event("change")));var l=document.getElementById("keyBorrowDate"),d=document.getElementById("keyReturnDate");if(l){var m=(0,u.qR)(l,"singleDateTime"),v=n.dataset.borrowDate;v&&m&&m.setStartDate(s()(v))}if(d){var h=(0,u.qR)(d,"singleDateTime"),p=n.dataset.returnDate;p&&h&&h.setStartDate(s()(p))}var f=n.dataset.userId,b=n.dataset.techId,g=n.dataset.prodId,k=n.dataset.cleanId,E=document.getElementById("borrowerType");if(E){var I=document.getElementById("userId");I&&(I.value="");var w=document.getElementById("technicianId");w&&(w.value="");var B=document.getElementById("productionId");B&&(B.value="");var T=document.getElementById("cleaningId");T&&(T.value=""),f&&I?(E.value="user",I.value=f):b&&w?(E.value="technician",w.value=b):g&&B?(E.value="production",B.value=g):k&&T?(E.value="cleaning",T.value=k):E.value="",E.dispatchEvent(new Event("change"))}y&&y.show()}function z(){var e=document.getElementById("keyId"),n=document.getElementById("keyStatus");if(e&&n){var t=e.value,a=n.value,i=function(e){var n=document.getElementById(e);return n?n.value:null},o=document.getElementById("keyBorrowDate"),c=document.getElementById("keyReturnDate"),r=null,l=null;if(o){var d=(0,u.IQ)(o);d&&d.startDate&&(r=d.startDate.format("YYYY-MM-DD HH:mm:ss"))}if(c){var s=(0,u.IQ)(c);s&&s.startDate&&(l=s.startDate.format("YYYY-MM-DD HH:mm:ss"))}var m={status:a,userId:i("userId"),technicianId:i("technicianId"),productionId:i("productionId"),cleaningId:i("cleaningId"),borrowDate:r,returnDate:l};fetch("/dashboard/key/".concat(t,"/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(function(e){e.ok?(y.hide(),window.location.reload()):alert("Fehler beim Speichern")}).catch(function(e){return console.error(e)})}}function G(){T(),function(){var e=document.getElementById("keyManagementModal");if(e){y=new l.aF(e),document.querySelectorAll(".key-item-btn").forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",function(){F(this)})});var n=document.getElementById("keyStatus");if(n){var t=n.cloneNode(!0);n.parentNode.replaceChild(t,n),t.addEventListener("change",function(){var e=document.getElementById("borrowDetails");"borrowed"===this.value?e&&(e.style.display="block"):e&&(e.style.display="none")})}var a=document.getElementById("borrowerType");if(a){var i=a.cloneNode(!0);a.parentNode.replaceChild(i,a),i.addEventListener("change",function(){if(document.querySelectorAll(".borrower-select").forEach(function(e){return e.style.display="none"}),this.value){var e=this.value+"SelectDiv",n=document.getElementById(e);n&&(n.style.display="block")}})}var o=document.getElementById("saveKeyBtn");if(o){var c=o.cloneNode(!0);o.parentNode.replaceChild(c,o),c.addEventListener("click",z)}}}()}window.__dashboardBound||(window.__dashboardBound=!0,document.addEventListener("DOMContentLoaded",G),document.addEventListener("turbo:load",G),document.addEventListener("turbo:render",G),document.addEventListener("turbo:visit",G))}}]);