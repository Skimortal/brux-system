"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1],{70001:(e,n,t)=>{t.r(n),t.d(n,{bootDashboard:()=>Q});t(52675),t(89463),t(2259),t(16280),t(76918),t(28706),t(2008),t(50113),t(51629),t(23418),t(74423),t(64346),t(23792),t(48598),t(62062),t(44114),t(34782),t(26910),t(59089),t(1688),t(60739),t(23288),t(62010),t(33110),t(5506),t(26099),t(3362),t(27495),t(90906),t(38781),t(99449),t(21699),t(47764),t(11392),t(50375),t(42762),t(98992),t(54520),t(72577),t(3949),t(81454),t(23500),t(62953),t(76031),t(47154);var a=t(67363),c=t(97950),i=t(90666),o=t(38680),r=t(39612),l=t(89336),d=t(95093),s=t.n(d),u=(t(84743),t(41661));function m(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,c,i,o,r=[],l=!0,d=!1;try{if(i=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;l=!1}else for(;!(l=(a=i.call(t)).done)&&(r.push(a.value),r.length!==n);l=!0);}catch(e){d=!0,c=e}finally{try{if(!l&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(d)throw c}}return r}}(e,n)||function(e,n){if(e){if("string"==typeof e)return h(e,n);var t={}.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?h(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=Array(n);t<n;t++)a[t]=e[t];return a}var p,v,f,y,b=new Date,g=[],k=null,E="global",I={bar:"Bar",setup:"Aufbau",teardown:"Abbau",ticketing:"Ticketing",cleanup:"Aufräumen",other:"Anderes"},w={borrowed:!0,available:!0,lost:!0};var B=null,S=null;function T(){var e=document.getElementById("appointmentModal");e&&(p=new l.aF(e));var n=document.getElementById("productionEventModal");n&&(v=new l.aF(n));var t=document.getElementById("deleteConfirmModal");t&&(y=new l.aF(t)),g.forEach(function(e){return e.destroy()}),g=[],k&&(k.destroy(),k=null),document.querySelectorAll(".filter-checkbox").forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("change",L)}),document.querySelectorAll('input[name="calendarView"]').forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("change",function(){var e,n,t;E=this.value,e=this.value,n=document.getElementById("globalCalendarContainer"),t=document.getElementById("roomCalendarsContainer"),"global"===e?(n&&(n.style.display="block"),t&&(t.style.display="none"),k&&(k.updateSize(),k.refetchEvents())):(n&&(n.style.display="none"),t&&(t.style.display="block"),g.forEach(function(e){e.updateSize(),e.refetchEvents()}))})});var d=document.getElementById("syncApiBtn");if(d){var s=d.cloneNode(!0);d.parentNode.replaceChild(s,d),s.addEventListener("click",D)}var u=window.innerWidth<=767;!function(e){var n=document.getElementById("global-calendar");if(!n)return;k=new a.Vv(n,{plugins:[c.A,i.A,o.Ay],initialView:e?"timeGridWeek":"dayGridMonth",locale:r.A,timeZone:"Europe/Berlin",firstDay:1,headerToolbar:e?{left:"prev,next",center:"title",right:"today,dayGridMonth,timeGridWeek,timeGridDay"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},slotMinTime:"08:00:00",slotMaxTime:"22:00:00",allDaySlot:!0,height:1e3,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1,meridiem:!1},eventDisplay:"block",eventContent:function(e){var n=e.event.title||"",t=document.createElement("div");return t.className="fc-event-title-container",t.innerHTML=n,{domNodes:[t]}},events:function(e,n,t){var a=Array.from(document.querySelectorAll(".filter-checkbox:checked")).map(function(e){return e.value}).join(","),c="/dashboard/events?roomId=&start=".concat(e.startStr,"&end=").concat(e.endStr,"&filters=").concat(a);fetch(c).then(function(e){return e.json()}).then(function(e){return n(e)}).catch(function(e){console.error("Error loading events:",e),t(e)})},dateClick:function(e){V(e.dateStr,null,e.date,null)},eventClick:function(e){M(e)},eventDidMount:function(e){var n=new Date,t=e.event.end||e.event.start;"key"===e.event.extendedProps.type?e.event.extendedProps.isOverdue&&(e.el.style.backgroundColor="#dc3545",e.el.style.borderColor="#bd2130",e.el.style.opacity="0.5"):t<n&&(e.el.style.textDecoration="line-through",e.el.style.opacity="0.5")},editable:!1}),k.render()}(u),function(e){document.querySelectorAll(".room-calendar").forEach(function(n){var t=function(e,n){var t=e.dataset.roomId||"",l=new a.Vv(e,{plugins:[c.A,i.A,o.Ay],initialView:n?"timeGridWeek":"dayGridMonth",locale:r.A,timeZone:"Europe/Berlin",firstDay:1,headerToolbar:n?{left:"prev,next",center:"title",right:"today,dayGridMonth,timeGridWeek,timeGridDay"}:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},slotMinTime:"08:00:00",slotMaxTime:"22:00:00",allDaySlot:!0,height:1e3,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1,meridiem:!1},eventDisplay:"block",eventContent:function(e){var n=e.event.title||"",t=document.createElement("div");return t.className="fc-event-title-container",t.innerHTML=n,{domNodes:[t]}},events:function(e,n,a){var c=Array.from(document.querySelectorAll(".filter-checkbox:checked")).map(function(e){return e.value}).join(","),i="/dashboard/events?roomId=".concat(t,"&start=").concat(e.startStr,"&end=").concat(e.endStr,"&filters=").concat(c);fetch(i).then(function(e){return e.json()}).then(function(e){return n(e)}).catch(function(e){console.error("Error loading events:",e),a(e)})},dateClick:function(e){V(e.dateStr,null,e.date,t)},eventClick:function(e){M(e)},eventDidMount:function(e){var n=new Date,t=e.event.end||e.event.start;"key"===e.event.extendedProps.type?e.event.extendedProps.isOverdue&&(e.el.style.backgroundColor="#dc3545",e.el.style.borderColor="#bd2130",e.el.style.opacity="0.5"):t<n&&(e.el.style.textDecoration="line-through",e.el.style.opacity="0.5")},editable:!1,datesSet:function(e){!function(e){if(e._isSyncing)return;g.forEach(function(n){if(n!==e){n._isSyncing=!0;var t=e.view.type,a=e.getDate();n.view.type!==t&&n.changeView(t),n.gotoDate(a),setTimeout(function(){n._isSyncing=!1},100)}})}(l)}});return l.render(),l}(n,e);g.push(t)})}(u),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){(function(e){b=new Date(e);var n=e.toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric"}),t=e.toLocaleDateString("de-DE",{weekday:"long"}),a=document.getElementById("day-number-text");a&&(a.textContent=n);var c=document.getElementById("day-suffix");c&&(c.textContent="");var i=document.getElementById("day-name");i&&(i.textContent=t.charAt(0).toUpperCase()+t.slice(1))})(b)}).catch(function(e){return console.error(e)}),function(){var e=document.getElementById("saveAppointmentBtn");if(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",F)}var t=document.getElementById("duplicateAppointmentBtn");if(t){var a=t.cloneNode(!0);t.parentNode.replaceChild(a,t),a.addEventListener("click",function(){S&&V(null,S,null,null,"duplicate")})}var c=document.getElementById("deleteAppointmentBtn");if(c){var i=c.cloneNode(!0);c.parentNode.replaceChild(i,c),i.addEventListener("click",function(){!function(e){B=e;var n=document.getElementById("deleteConfirmMessage"),t=document.getElementById("deleteRecurringOptions");e?(t.style.display="block",n.textContent="Möchten Sie diesen Termin löschen?"):(t.style.display="none",n.textContent="Möchten Sie diesen Termin wirklich löschen?");y&&y.show()}(document.getElementById("appointmentId").value)})}var o=document.getElementById("confirmDeleteBtn");if(o){var r=o.cloneNode(!0);o.parentNode.replaceChild(r,o),r.addEventListener("click",G)}var l=document.getElementById("appointmentAllDay");if(l){var d=l.cloneNode(!0);l.parentNode.replaceChild(d,l),d.addEventListener("change",_)}var s=document.getElementById("appointmentRecurring");if(s){var u=s.cloneNode(!0);s.parentNode.replaceChild(u,s),u.addEventListener("change",P)}document.querySelectorAll(".appointment-type-radio").forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("change",N)});var m=document.getElementById("add-appointment-btn");if(m){var h=m.cloneNode(!0);m.parentNode.replaceChild(h,m),h.addEventListener("click",function(){V(b.toISOString().split("T")[0])})}}()}function x(){var e=document.getElementById("day-events-list");if(e){fetch("/dashboard/all-keys").then(function(e){return e.json()}).then(function(n){var t=n.filter(function(e){return w[e.status]}).sort(function(e,n){var t={borrowed:0,available:1,lost:2};return t[e.status]-t[n.status]});e.innerHTML="",t.forEach(function(n){var t="c-green-500",a="ti-check",c="Verfügbar";"borrowed"===n.status?(t="c-amber-500",a="ti-export",c="Verliehen"):"lost"===n.status&&(t="c-red-500",a="ti-close",c="Verloren");var i=n.currentHolderName||"",o=n.rooms&&n.rooms.length>0?n.rooms.map(function(e){return e.name}).join(", "):"-",r=document.createElement("li");r.className="bdB peers ai-c jc-sb fxw-nw key-item-btn",r.style.cursor="pointer",r.dataset.keyId=n.id,r.dataset.keyName=n.name,r.dataset.keyStatus=n.status,r.dataset.borrowDate=n.borrowDate||"",r.dataset.returnDate=n.returnDate||"",r.dataset.userId=n.user?n.user.id:"",r.dataset.techId=n.technician?n.technician.id:"",r.dataset.prodId=n.production?n.production.id:"",r.dataset.cleanId=n.cleaning?n.cleaning.id:"",r.dataset.description=n.description||"",r.innerHTML='\n                    <div class="td-n p-20 peers fxw-nw me-20 peer-greed c-grey-900">\n                        <div class="peer mR-15">\n                            <i class="ti-key '.concat(t,'"></i>\n                        </div>\n                        <div class="peer">\n                            <span class="fw-600">').concat(n.name," (").concat(o,')</span>\n                            <div class="c-grey-600">\n                                ').concat("borrowed"===n.status?'<span class="c-grey-700">'.concat(i,"</span>"):'<span class="c-grey-700">&nbsp;</span>',"\n                                <i>").concat(c,'</i>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="peers mR-15">\n                        <div class="peer">\n                            <span class="fsz-md p-5" title="').concat(c,'">\n                                <i class="').concat(a," ").concat(t,'"></i>\n                            </span>\n                        </div>\n                    </div>\n                '),r.addEventListener("click",function(){U(n.id)}),e.appendChild(r)})}).catch(function(e){return console.error("Error loading keys:",e)})}}function D(){var e=document.getElementById("syncApiBtn");if(e){var n=e.innerHTML;e.disabled=!0,e.innerHTML='<i class="ti-reload spin"></i> Synchronisiere...';var t=document.createElement("style");t.textContent="\n        .spin {\n            animation: spin 1s linear infinite;\n        }\n        @keyframes spin {\n            from { transform: rotate(0deg); }\n            to { transform: rotate(360deg); }\n        }\n    ",document.querySelector("style[data-sync-spinner]")||(t.setAttribute("data-sync-spinner","true"),document.head.appendChild(t)),fetch("/dashboard/sync-api",{method:"POST",headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(t){e.disabled=!1,e.innerHTML=n,t.success?(C("success",t.message),L(),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){0})):C("error",t.message||"Fehler bei der Synchronisation")}).catch(function(t){e.disabled=!1,e.innerHTML=n,console.error("Sync error:",t),C("error","Netzwerkfehler bei der Synchronisation")})}}function C(e,n){var t=document.createElement("div");t.className="alert alert-".concat("success"===e?"success":"danger"," alert-dismissible fade show position-fixed"),t.style.cssText="top: 20px; right: 20px; z-index: 9999; max-width: 400px;",t.innerHTML="\n        ".concat(n,'\n        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>\n    '),document.body.appendChild(t),setTimeout(function(){t.remove()},5e3)}function L(){"global"===E?k&&k.refetchEvents():g.forEach(function(e){return e.refetchEvents()})}function A(){L()}function M(e){var n=e.event.extendedProps.type;if("production_event"===n){var t=e.event.extendedProps.productionEventId;t&&function(e){var n=document.getElementById("productionEventModalBody"),t=document.getElementById("productionEventModalTitle"),a=document.getElementById("editProductionEventBtn");if(!v)return;n.innerHTML='\n        <div class="text-center p-5">\n            <div class="spinner-border text-primary" role="status">\n                <span class="visually-hidden">Laden...</span>\n            </div>\n        </div>\n    ',v.show(),fetch("/dashboard/production-event/".concat(e,"/details")).then(function(e){return e.json()}).then(function(e){if(e.error)n.innerHTML='<div class="alert alert-danger">'.concat(e.error,"</div>");else{var c=e.event,i=e.production;t.textContent=i?i.title:"Veranstaltung",a&&(a.href="/production-event/".concat(c.id,"/edit"),a.style.display="inline-block");var o="";if(i&&i.postThumbnailUrl&&(o+='\n                    <div class="text-center mb-4">\n                        <img src="'.concat(i.postThumbnailUrl,'"\n                             alt="').concat(i.title,'"\n                             class="img-fluid rounded"\n                             style="max-height: 300px; object-fit: cover;">\n                    </div>\n                ')),o+='<div class="row mb-4">',o+='<div class="col-md-6">',o+='<h6 class="text-muted mb-3">Veranstaltungsinformationen</h6>',c.date&&(o+='\n                    <div class="mb-2">\n                        <strong><i class="ti-calendar me-2"></i>Datum:</strong>\n                        '.concat(c.date,"\n                    </div>\n                ")),c.timeFrom&&(o+='\n                    <div class="mb-2">\n                        <strong><i class="ti-time me-2"></i>Uhrzeit:</strong>\n                        '.concat(c.timeFrom).concat(c.timeTo?" - "+c.timeTo:""," Uhr\n                    </div>\n                ")),c.room&&(o+='\n                    <div class="mb-2">\n                        <strong><i class="ti-location-pin me-2"></i>Raum:</strong>\n                        '.concat(c.room,"\n                    </div>\n                ")),c.status){var r=c.status.includes("Aktiv")?"success":"secondary";o+='\n                    <div class="mb-2">\n                        <strong>Status:</strong>\n                        <span class="badge bg-'.concat(r,'">').concat(c.status,"</span>\n                    </div>\n                ")}var l=Array.isArray(c.productionContactPersons)?c.productionContactPersons:[],d=Array.isArray(c.assignedContactPersonIds)?c.assignedContactPersonIds:[];if(l.length>0){var s=l.map(function(e){var n=[e.name];e.email&&n.push(e.email),e.phone&&n.push(e.phone);var t=n.join(" • "),a=d.includes(e.id)?"selected":"";return'<option value="'.concat(e.id,'" ').concat(a,">").concat(t,"</option>")}).join("");o+='\n                    <div class="mb-2">\n                        <strong>Ansprechpartner:</strong>\n                        <select\n                            id="productionEventContactPersons"\n                            class="form-select tom-select"\n                            multiple\n                            data-placeholder="Bitte auswählen"\n                        >\n                            '.concat(s,'\n                        </select>\n                        <small class="text-muted d-block mt-1">\n                            Zuordnung gilt für dieses Event.\n                        </small>\n                    </div>\n                ')}else o+='\n                    <div class="mb-2">\n                        <strong>Ansprechpartner:</strong>\n                        <div class="text-muted">Keine Ansprechpartner in der Produktion hinterlegt.</div>\n                    </div>\n                ';if(o+="</div>",o+='<div class="col-md-6">',o+='<h6 class="text-muted mb-3">Plätze & Reservierungen</h6>',null!==c.quota&&(o+='\n                    <div class="mb-2">\n                        <strong><i class="ti-package me-2"></i>Kontingent:</strong>\n                        '.concat(c.quota," Plätze\n                    </div>\n                ")),null!==c.incomingTotal&&(o+='\n                    <div class="mb-2">\n                        <strong><i class="ti-check me-2"></i>Reserviert:</strong>\n                        '.concat(c.incomingTotal,"\n                    </div>\n                ")),null!==c.freeSeats){var u=c.freeSeats>10?"success":c.freeSeats>0?"warning":"danger";o+='\n                    <div class="mb-2">\n                        <strong><i class="ti-ticket me-2"></i>Frei:</strong>\n                        <span class="badge bg-'.concat(u,'">').concat(c.freeSeats,"</span>\n                    </div>\n                ")}if(o+="</div>",o+="</div>",c.prices&&c.prices.length>0&&(o+='\n                    <div class="mb-4">\n                        <h6 class="text-muted mb-3">Preise</h6>\n                        <div class="table-responsive">\n                            <table class="table table-sm table-bordered">\n                                <thead class="table-light">\n                                    <tr>\n                                        <th>Kategorie</th>\n                                        <th>Preis</th>\n                                        <th>Reservierungen</th>\n                                    </tr>\n                                </thead>\n                                <tbody>\n                ',c.prices.forEach(function(e){o+="\n                        <tr>\n                            <td>".concat(e.categoryLabel||"-","</td>\n                            <td><strong>").concat(e.priceLabel||"0","€</strong></td>\n                            <td>").concat(e.incomingReservations||0,"</td>\n                        </tr>\n                    ")}),o+="\n                                </tbody>\n                            </table>\n                        </div>\n                    </div>\n                "),c.categories&&c.categories.length>0&&(o+='\n                    <div class="mb-4">\n                        <h6 class="text-muted mb-2">Hinweise</h6>\n                        <div>\n                ',c.categories.forEach(function(e){var n="ausverkauft-event"===e.slug?"danger":"info";o+='<span class="badge bg-'.concat(n,' me-2">').concat(e.name,"</span>")}),o+="\n                        </div>\n                    </div>\n                "),c.reservationNote){var m=c.reservationNote.startsWith("http");o+='\n                    <div class="mb-4">\n                        <h6 class="text-muted mb-2">Reservierung</h6>\n                        '.concat(m?'<a href="'.concat(c.reservationNote,'" target="_blank" class="btn btn-sm btn-primary">\n                                <i class="ti-new-window me-1"></i>Zur Reservierung\n                            </a>'):'<p class="mb-0">'.concat(c.reservationNote,"</p>"),"\n                    </div>\n                ")}i&&i.contentHtml&&(o+='\n                    <div class="mt-4 pt-4 border-top">\n                        <h6 class="text-muted mb-3">Über die Produktion</h6>\n                        <div class="production-content">\n                            '.concat(i.contentHtml,"\n                        </div>\n                    </div>\n                ")),i&&i.permalink&&(o+='\n                    <div class="mt-3">\n                        <a href="'.concat(i.permalink,'" target="_blank" class="btn btn-sm btn-secondary">\n                            <i class="ti-link me-1"></i>Zur Website\n                        </a>\n                    </div>\n                ')),n.innerHTML=o,window.initTomSelect&&window.initTomSelect();var h=document.getElementById("productionEventContactPersons");h&&h.addEventListener("change",function(){var e=Array.from(h.selectedOptions).map(function(e){return e.value});fetch("/dashboard/production-event/".concat(c.id,"/contact-persons"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contactPersonIds:e})}).then(function(e){return e.json()}).then(function(e){e&&e.success?C("success","Ansprechpartner gespeichert"):C("error",e&&e.message?e.message:"Speichern fehlgeschlagen")}).catch(function(){C("error","Netzwerkfehler beim Speichern")})})}}).catch(function(e){console.error("Error loading event details:",e),n.innerHTML='\n                <div class="alert alert-danger">\n                    Fehler beim Laden der Event-Details.\n                </div>\n            '})}(t)}else if("key"===n){var a=e.event.extendedProps.keyId;a&&U(a)}else["private","cleaning","production"].includes(n)?V(null,e.event):alert(e.event.title+"\n"+(e.event.extendedProps.description||""))}function P(e){var n=document.getElementById("recurrenceOptions"),t=document.getElementById("recurrenceEndDate");n&&(n.style.display=e.target.checked?"block":"none"),e.target.checked&&t&&(0,u.qR)(t,"singleDate"),!e.target.checked&&t&&(t.value="")}function N(){var e=document.querySelector('input[name="appointmentType"]:checked');if(e){var n,t=e.value,a=document.getElementById("typeSpecificFields");if(a)switch(a.innerHTML="",function(e){var n=document.getElementById("appointmentTitle");if(!n)return;var t=n.closest(".mb-3"),a="production"===e||"cleaning"===e;t&&(t.style.display=a?"none":"block");n.required=!a,a&&(n.value="")}(t),t){case"private":break;case"production":a.innerHTML=function(){var e=window.dashboardData.allProductions||[];window.dashboardData.allTechnicians,window.dashboardData.allVolunteers;return'\n        <div class="border-top pt-3 mt-3">\n            <h6 class="fw-bold mb-3">Produktions-Details</h6>\n\n            <div class="mb-3">\n                <label for="productionSelect" class="form-label">Produktion</label>\n                <select class="form-select" id="productionSelect">\n                    <option value="">Bitte wählen...</option>\n                    '.concat(e.map(function(e){return'<option value="'.concat(e.id,'">').concat(e.title||e.displayName,"</option>")}).join(""),'\n                </select>\n            </div>\n\n            <div id="productionRequirementsInfo" class="mb-3" style="display:none;">\n                <div class="alert alert-info py-2 px-3 small mb-0">\n                    <strong>Produktion benötigt:</strong> <span id="reqFlagsList"></span>\n                </div>\n            </div>\n\n            <div class="mb-3">\n                <label class="form-label d-block">Ereignisart</label>\n                <div class="btn-group w-100" role="group">\n                    <input type="radio" class="btn-check" name="eventType" id="eventTypeRehearsal" value="rehearsal">\n                    <label class="btn btn-outline-secondary" for="eventTypeRehearsal">\n                        <i class="ti-music-alt"></i> Probe\n                    </label>\n\n                    <input type="radio" class="btn-check" name="eventType" id="eventTypeSetup" value="setup_teardown">\n                    <label class="btn btn-outline-secondary" for="eventTypeSetup">\n                        <i class="ti-package"></i> Aufbau/Abbau\n                    </label>\n\n                    <input type="radio" class="btn-check" name="eventType" id="eventTypeEvent" value="event">\n                    <label class="btn btn-outline-secondary" for="eventTypeEvent">\n                        <i class="ti-flag-alt"></i> Veranstaltung\n                    </label>\n                </div>\n            </div>\n\n            <div class="mb-3">\n                <label class="form-label">Status</label>\n                <div class="btn-group w-100" role="group">\n                    <input type="radio" class="btn-check" name="appointmentStatus" id="statusReserved" value="reserved">\n                    <label class="btn btn-outline-warning" for="statusReserved">Reserviert</label>\n\n                    <input type="radio" class="btn-check" name="appointmentStatus" id="statusConfirmed" value="confirmed">\n                    <label class="btn btn-outline-success" for="statusConfirmed">Fix</label>\n                </div>\n            </div>\n\n            <div class="mb-3 form-check">\n                <input type="checkbox" class="form-check-input" id="internalTechniciansAttending">\n                <label class="form-check-label" for="internalTechniciansAttending">\n                    Externe Techniker kommen\n                </label>\n            </div>\n\n            <div class="mb-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignTechniciansCheckbox">\n                    <label class="form-check-label fw-bold" for="assignTechniciansCheckbox">\n                        Techniker zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="techniciansContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 50%;">Techniker</th>\n                            <th style="width: 25%;">Bestätigt</th>\n                            <th style="width: 25%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="techniciansList">\n                    </tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addTechnicianBtn">\n                    <i class="ti-plus"></i> Techniker hinzufügen\n                </button>\n            </div>\n\n            <div class="mb-3 mt-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignVolunteersCheckbox">\n                    <label class="form-check-label fw-bold" for="assignVolunteersCheckbox">\n                        Volunteers zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="volunteersContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 35%;">Volunteer</th>\n                            <th style="width: 20%;">Bestätigt</th>\n                            <th style="width: 35%;">Aufgaben</th>\n                            <th style="width: 10%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="volunteersList">\n                    </tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addVolunteerBtn">\n                    <i class="ti-plus"></i> Volunteer hinzufügen\n                </button>\n            </div>\n        </div>\n    ')}(),R();break;case"closed_event":a.innerHTML=q("Veranstaltungs-Details"),R();break;case"school_event":a.innerHTML=q("Schulveranstaltung"),R();break;case"internal":a.innerHTML=q("Interner Termin"),R();break;case"cleaning":a.innerHTML=(n=window.dashboardData.allCleanings||[],'\n            <div class="border-top pt-3 mt-3">\n                <h6 class="fw-bold mb-3">Reinigungs-Details</h6>\n\n                <div class="mb-3">\n                    <label for="cleaningSelect" class="form-label">Reinigung</label>\n                    <select class="form-select" id="cleaningSelect">\n                        <option value="">Bitte wählen...</option>\n                        '.concat(n.map(function(e,n){return'<option value="'.concat(e.id,'" ').concat(0===n?"selected":"",">").concat(e.name,"</option>")}).join(""),'\n                    </select>\n                </div>\n\n                <div class="mb-3">\n                    <label class="form-label d-block">Zusatzoptionen</label>\n                    <div class="form-check form-check-inline">\n                        <input class="form-check-input cleaning-option" type="checkbox" id="cleanDaily" value="daily">\n                        <label class="form-check-label" for="cleanDaily">Tägliche Reinigung</label>\n                    </div>\n                    <div class="form-check form-check-inline">\n                        <input class="form-check-input cleaning-option" type="checkbox" id="cleanBlack" value="black">\n                        <label class="form-check-label" for="cleanBlack">Raum Schwarz</label>\n                    </div>\n                    <div class="form-check form-check-inline">\n                        <input class="form-check-input cleaning-option" type="checkbox" id="cleanWhite" value="white">\n                        <label class="form-check-label" for="cleanWhite">Raum Weiss</label>\n                    </div>\n                    <div class="form-check form-check-inline">\n                        <input class="form-check-input cleaning-option" type="checkbox" id="cleanWardrobe" value="wardrobe">\n                        <label class="form-check-label" for="cleanWardrobe">Künstlerinnengarderobe</label>\n                    </div>\n                    <div class="form-check form-check-inline">\n                        <input class="form-check-input cleaning-option" type="checkbox" id="cleanToilet" value="toilet">\n                        <label class="form-check-label" for="cleanToilet">Publikumstoilette</label>\n                    </div>\n                    <div class="form-check form-check-inline">\n                        <input class="form-check-input cleaning-option" type="checkbox" id="cleanOffice" value="office">\n                        <label class="form-check-label" for="cleanOffice">Büro</label>\n                    </div>\n                </div>\n            </div>\n        '))}}}function q(e){return'\n        <div class="border-top pt-3 mt-3">\n            <h6 class="fw-bold mb-3">'.concat(e,'</h6>\n\n            <div class="mb-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignTechniciansCheckbox">\n                    <label class="form-check-label fw-bold" for="assignTechniciansCheckbox">\n                        Techniker zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="techniciansContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 50%;">Techniker</th>\n                            <th style="width: 25%;">Bestätigt</th>\n                            <th style="width: 25%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="techniciansList"></tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addTechnicianBtn">\n                    <i class="ti-plus"></i> Techniker hinzufügen\n                </button>\n            </div>\n\n            <div class="mb-3 mt-3">\n                <div class="form-check">\n                    <input type="checkbox" class="form-check-input" id="assignVolunteersCheckbox">\n                    <label class="form-check-label fw-bold" for="assignVolunteersCheckbox">\n                        Volunteers zuweisen\n                    </label>\n                </div>\n            </div>\n\n            <div id="volunteersContainer" style="display: none;">\n                <table class="table table-bordered table-sm">\n                    <thead>\n                        <tr>\n                            <th style="width: 35%;">Volunteer</th>\n                            <th style="width: 20%;">Bestätigt</th>\n                            <th style="width: 35%;">Aufgaben</th>\n                            <th style="width: 10%;"></th>\n                        </tr>\n                    </thead>\n                    <tbody id="volunteersList"></tbody>\n                </table>\n                <button type="button" class="btn btn-sm btn-success" id="addVolunteerBtn">\n                    <i class="ti-plus"></i> Volunteer hinzufügen\n                </button>\n            </div>\n        </div>\n    ')}function R(){var e=document.getElementById("productionSelect");e&&e.addEventListener("change",function(){H(this.value)});var n=document.getElementById("assignTechniciansCheckbox"),t=document.getElementById("techniciansContainer"),a=document.getElementById("addTechnicianBtn");n&&t&&n.addEventListener("change",function(){t.style.display=this.checked?"block":"none"}),a&&a.addEventListener("click",j);var c=document.getElementById("assignVolunteersCheckbox"),i=document.getElementById("volunteersContainer"),o=document.getElementById("addVolunteerBtn");c&&i&&c.addEventListener("change",function(){i.style.display=this.checked?"block":"none"}),o&&o.addEventListener("click",O)}function H(e){var n=document.getElementById("productionRequirementsInfo"),t=document.getElementById("reqFlagsList"),a=(window.dashboardData.allProductions||[]).find(function(n){return n.id==e});if(a&&(a.needsLighting||a.needsSound||a.needsSetup||a.grandstand)){var c=[];a.needsLighting&&c.push("Licht"),a.needsSound&&c.push("Ton"),a.needsSetup&&c.push("Aufbau");var i=c.join(", ");a.grandstand&&(i+=(i?" | ":"")+a.grandstand),t&&(t.textContent=i),n&&(n.style.display="block")}else n&&(n.style.display="none");document.querySelectorAll("#techniciansList tr").forEach(function(e){Y(e,a)})}function Y(e,n){var t=e.querySelector(".lighting-wrap"),a=e.querySelector(".sound-wrap"),c=e.querySelector(".setup-wrap");t&&(t.style.display=n&&n.needsLighting?"inline-block":"none"),a&&(a.style.display=n&&n.needsSound?"inline-block":"none"),c&&(c.style.display=n&&n.needsSetup?"inline-block":"none")}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=window.dashboardData.allTechnicians||[],t=document.getElementById("techniciansList");if(t){var a=document.getElementById("productionSelect"),c=a?a.value:null,i=(window.dashboardData.allProductions||[]).find(function(e){return e.id==c}),o=document.createElement("tr"),r="tech_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);o.dataset.rowId=r,o.innerHTML='\n            <td>\n                <select class="form-select form-select-sm technician-select" data-row-id="'.concat(r,'">\n                    <option value="">Wählen...</option>\n                    ').concat(n.map(function(n){return'\n                        <option value="'.concat(n.id,'" ').concat(e&&e.id==n.id?"selected":"",">\n                            ").concat(n.name,"\n                        </option>\n                    ")}).join(""),'\n                </select>\n            </td>\n            <td>\n                <div class="form-check form-check-inline">\n                    <input type="checkbox" class="form-check-input technician-confirmed" data-row-id="').concat(r,'" ').concat(e&&e.confirmed?"checked":"",'>\n                    <label class="form-check-label small">Bestätigt</label>\n                </div>\n                <div class="form-check form-check-inline lighting-wrap" style="display:none;">\n                    <input type="checkbox" class="form-check-input technician-lighting" data-row-id="').concat(r,'" ').concat(e&&e.lighting?"checked":"",'>\n                    <label class="form-check-label small"><i class="ti-light-bulb" title="Licht"></i></label>\n                </div>\n                <div class="form-check form-check-inline sound-wrap" style="display:none;">\n                    <input type="checkbox" class="form-check-input technician-sound" data-row-id="').concat(r,'" ').concat(e&&e.sound?"checked":"",'>\n                    <label class="form-check-label small"><i class="ti-announcement" title="Ton"></i></label>\n                </div>\n                <div class="form-check form-check-inline setup-wrap" style="display:none;">\n                    <input type="checkbox" class="form-check-input technician-setup" data-row-id="').concat(r,'" ').concat(e&&e.setup?"checked":"",'>\n                    <label class="form-check-label small"><i class="ti-settings" title="Aufbau"></i></label>\n                </div>\n            </td>\n            <td class="text-center">\n                <button type="button" class="btn btn-sm btn-danger remove-technician-btn" data-row-id="').concat(r,'">\n                    <i class="ti-trash"></i>\n                </button>\n            </td>\n        '),t.appendChild(o),Y(o,i),o.querySelector(".remove-technician-btn").addEventListener("click",function(){o.remove()})}}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=window.dashboardData.allVolunteers||[],t=document.getElementById("volunteersList");if(t){var a=document.createElement("tr"),c="vol_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);a.dataset.rowId=c;var i=Object.entries(I).map(function(n){var t=m(n,2),a=t[0],i=t[1],o=e&&e.tasks&&e.tasks.includes(a)?"checked":"";return'\n            <div class="form-check form-check-inline">\n                <input class="form-check-input volunteer-task" type="checkbox"\n                       value="'.concat(a,'"\n                       data-row-id="').concat(c,'"\n                       ').concat(o,'>\n                <label class="form-check-label" style="font-size: 0.85rem;">').concat(i,"</label>\n            </div>\n        ")}).join("");a.innerHTML='\n        <td>\n            <select class="form-select form-select-sm volunteer-select" data-row-id="'.concat(c,'">\n                <option value="">Wählen...</option>\n                ').concat(n.map(function(n){return'\n                    <option value="'.concat(n.id,'" ').concat(e&&e.id==n.id?"selected":"",">\n                        ").concat(n.name,"\n                    </option>\n                ")}).join(""),'\n            </select>\n        </td>\n        <td class="text-center">\n            <input type="checkbox" class="form-check-input volunteer-confirmed"\n                   data-row-id="').concat(c,'"\n                   ').concat(e&&e.confirmed?"checked":"",">\n        </td>\n        <td>\n            ").concat(i,'\n        </td>\n        <td class="text-center">\n            <button type="button" class="btn btn-sm btn-danger remove-volunteer-btn" data-row-id="').concat(c,'">\n                <i class="ti-trash"></i>\n            </button>\n        </td>\n    '),t.appendChild(a),a.querySelector(".remove-volunteer-btn").addEventListener("click",function(){a.remove()})}}function V(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"edit",i=document.getElementById("appointmentModalLabel"),o=document.getElementById("deleteAppointmentBtn"),r=document.getElementById("duplicateAppointmentBtn"),l=document.getElementById("appointmentRoom"),d=document.getElementById("appointmentTitle"),m=document.getElementById("appointmentDescription"),h=document.getElementById("appointmentDateRange"),v=document.getElementById("appointmentAllDay"),f=document.getElementById("appointmentRecurring");S=null,l&&(l.value=""),d&&(d.value=""),m&&(m.value=""),v&&(v.checked=!1),f&&(f.checked=!1),document.getElementById("recurrenceOptions").style.display="none",r&&(r.style.display="none");var y=document.getElementById("typePrivate");y&&(y.checked=!0,N());var b=(0,u.qR)(h,"dateTimeRange");if(n){var g,k,E;S=n;var I="duplicate"===c;I?(i.textContent="Termin duplizieren",o&&(o.style.display="none")):(i.textContent="Termin bearbeiten",o&&(o.style.display="inline-block"),r&&(r.style.display="inline-block"));var w=String(n.id),B=w;w.includes("_")&&(B=w.split("_")[1]),document.getElementById("appointmentId").value=I?"":B;var T=(null===(g=n.extendedProps)||void 0===g?void 0:g.originalTitle)||n.title;d&&(d.value=I?function(e){var n=(e||"").trim();return n?n.endsWith(" (Kopie)")?n:"".concat(n," (Kopie)"):""}(T):T),m&&(m.value=(null===(k=n.extendedProps)||void 0===k?void 0:k.description)||""),n.extendedProps&&n.extendedProps.roomId&&l&&(l.value=n.extendedProps.roomId);var x=(null===(E=n.extendedProps)||void 0===E?void 0:E.appointmentType)||"private",D=document.querySelector('input[name="appointmentType"][value="'.concat(x,'"]'));D&&(D.checked=!0,N());var C=s()(n.startStr),L=s()(n.endStr||n.startStr);n.allDay&&L.subtract(1,"days"),b.setStartDate(C),b.setEndDate(L),v&&(v.checked=n.allDay),_({target:{checked:n.allDay}}),setTimeout(function(){!function(e){var n,t=null===(n=e.extendedProps)||void 0===n?void 0:n.appointmentType;if("production"===t||"closed_event"===t||"school_event"===t||"internal"===t){var a,c,i,o,r;if("production"===t&&null!==(a=e.extendedProps)&&void 0!==a&&a.productionId){var l=document.getElementById("productionSelect");l&&(l.value=e.extendedProps.productionId),H(e.extendedProps.productionId)}if(null!==(c=e.extendedProps)&&void 0!==c&&c.eventType){var d=document.querySelector('input[name="eventType"][value="'.concat(e.extendedProps.eventType,'"]'));d&&(d.checked=!0)}if(null!==(i=e.extendedProps)&&void 0!==i&&i.status){var s=document.querySelector('input[name="appointmentStatus"][value="'.concat(e.extendedProps.status,'"]'));s&&(s.checked=!0)}var u,m=document.getElementById("internalTechniciansAttending");if(m)m.checked=(null===(u=e.extendedProps)||void 0===u?void 0:u.internalTechniciansAttending)||!1;if(null!==(o=e.extendedProps)&&void 0!==o&&o.technicians&&e.extendedProps.technicians.length>0){var h=document.getElementById("assignTechniciansCheckbox");h&&(h.checked=!0,h.dispatchEvent(new Event("change"))),setTimeout(function(){e.extendedProps.technicians.forEach(function(e){j(e)})},100)}if(null!==(r=e.extendedProps)&&void 0!==r&&r.volunteers&&e.extendedProps.volunteers.length>0){var p=document.getElementById("assignVolunteersCheckbox");p&&(p.checked=!0,p.dispatchEvent(new Event("change"))),setTimeout(function(){e.extendedProps.volunteers.forEach(function(e){O(e)})},100)}}else if("cleaning"===t){var v,f;if(null!==(v=e.extendedProps)&&void 0!==v&&v.cleaningId){var y=document.getElementById("cleaningSelect");y&&(y.value=e.extendedProps.cleaningId)}null!==(f=e.extendedProps)&&void 0!==f&&f.cleaningOptions&&e.extendedProps.cleaningOptions.forEach(function(e){var n=document.querySelector('.cleaning-option[value="'.concat(e,'"]'));n&&(n.checked=!0)})}}(n)},100)}else{var A,M;i.textContent="Neuer Termin",o&&(o.style.display="none"),document.getElementById("appointmentId").value="",a&&l&&(l.value=a),t?(A=s()(t),M=s()(t).add(1,"hours"),v&&(v.checked=!1)):((A=e?s()(e):s()()).hours(9).minutes(0).seconds(0),M=s()(A).add(1,"hours"),v&&(v.checked=!1)),b.setStartDate(A),b.setEndDate(M),_({target:{checked:!1}})}p&&p.show()}function _(e){var n=document.getElementById("appointmentDateRange");if(n){var t=(0,u.IQ)(n);if(t){if(e.target.checked){var a=t.startDate,c=t.endDate;t.timePicker=!1,t.locale.format="DD.MM.YYYY",t.setStartDate(a.startOf("day")),t.setEndDate(c.startOf("day"))}else t.timePicker=!0,t.timePicker24Hour=!0,t.timePickerIncrement=15,t.locale.format="DD.MM.YYYY HH:mm";t.updateView()}}}function F(){var e=document.getElementById("appointmentId").value,n=document.getElementById("appointmentTitle").value,t=document.getElementById("appointmentDescription").value,a=document.getElementById("appointmentRoom")?document.getElementById("appointmentRoom").value:null,c=document.querySelector('input[name="appointmentType"]:checked'),i=c?c.value:"private";if(!n&&("production"===i||"cleaning"===i))if("production"===i){var o=document.getElementById("productionSelect");n=(o&&o.selectedOptions&&o.selectedOptions[0]?o.selectedOptions[0].textContent.trim():"")||"Produktion"}else if("cleaning"===i){var r=document.getElementById("cleaningSelect");n=(r&&r.selectedOptions&&r.selectedOptions[0]?r.selectedOptions[0].textContent.trim():"")||"Reinigung"}if(n||"production"===i||"cleaning"===i){var l=document.getElementById("appointmentAllDay").checked,d=document.getElementById("appointmentDateRange"),s=(0,u.IQ)(d);if(s&&s.startDate&&s.endDate){var m,h,v=s.startDate,f=s.endDate;l?(m=v.format("YYYY-MM-DD")+"T00:00:00",h=f.clone().add(1,"days").format("YYYY-MM-DD")+"T00:00:00"):(m=v.format("YYYY-MM-DDTHH:mm:ss"),h=f.format("YYYY-MM-DDTHH:mm:ss"));var y={title:n,description:t,start:m,end:h,allDay:l,roomId:a,type:i};if("production"===i){var b=document.getElementById("productionSelect");y.productionId=b?b.value:null;var g=document.querySelector('input[name="eventType"]:checked');y.eventType=g?g.value:null;var k=document.querySelector('input[name="appointmentStatus"]:checked');y.status=k?k.value:null;var E=document.getElementById("internalTechniciansAttending");y.internalTechniciansAttending=!!E&&E.checked,y.technicians=z(),y.volunteers=W()}else if(["closed_event","school_event","internal","private"].includes(i)){var I=document.getElementById("assignTechniciansCheckbox"),w=document.getElementById("assignVolunteersCheckbox");y.technicians=I&&I.checked?z():[],y.volunteers=w&&w.checked?W():[],y.eventType=null,y.status=null,y.internalTechniciansAttending=!1}else if("cleaning"===i){var B=document.getElementById("cleaningSelect");y.cleaningId=B?B.value:null,y.cleaningOptions=Array.from(document.querySelectorAll(".cleaning-option:checked")).map(function(e){return e.value})}var S=document.getElementById("appointmentRecurring");if(S&&S.checked){var T=document.getElementById("recurrenceFrequency"),x=document.getElementById("recurrenceEndDate");if(T&&(y.recurrenceFrequency=T.value),x){var D=(0,u.IQ)(x)||(0,u.qR)(x,"singleDate");D&&D.startDate&&(y.recurrenceEndDate=D.startDate.format("YYYY-MM-DD"))}if(!y.recurrenceEndDate)return void alert("Bitte geben Sie ein Enddatum für die Wiederholung an.")}var L=e?"/appointment/".concat(e,"/edit"):"/appointment/create";fetch(L,{method:e?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then(function(e){return e.json()}).then(function(e){e.success?(p.hide(),A(),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){0}),C("success","Termin erfolgreich gespeichert")):alert("Fehler beim Speichern: "+(e.message||"Unbekannter Fehler"))}).catch(function(e){console.error(e),alert("Fehler beim Speichern.")})}else alert("Bitte wählen Sie einen Zeitraum aus.")}else alert("Bitte geben Sie einen Titel ein.")}function z(){var e=document.querySelectorAll("#techniciansList tr"),n=[];return e.forEach(function(e){var t=e.dataset.rowId,a=e.querySelector('.technician-select[data-row-id="'.concat(t,'"]')),c=e.querySelector('.technician-confirmed[data-row-id="'.concat(t,'"]')),i=e.querySelector('.technician-lighting[data-row-id="'.concat(t,'"]')),o=e.querySelector('.technician-sound[data-row-id="'.concat(t,'"]')),r=e.querySelector('.technician-setup[data-row-id="'.concat(t,'"]'));a&&a.value&&n.push({id:a.value,confirmed:!!c&&c.checked,lighting:!!i&&i.checked,sound:!!o&&o.checked,setup:!!r&&r.checked})}),n}function W(){var e=document.querySelectorAll("#volunteersList tr"),n=[];return e.forEach(function(e){var t=e.dataset.rowId,a=e.querySelector('.volunteer-select[data-row-id="'.concat(t,'"]')),c=e.querySelector('.volunteer-confirmed[data-row-id="'.concat(t,'"]')),i=e.querySelectorAll('.volunteer-task[data-row-id="'.concat(t,'"]:checked'));if(a&&a.value){var o=Array.from(i).map(function(e){return e.value});n.push({id:a.value,confirmed:!!c&&c.checked,tasks:o})}}),n}function G(){if(B){var e=document.querySelector('input[name="deleteMode"]:checked'),n=e?e.value:"single",t=String(B),a=t;t.includes("_")&&(a=t.split("_")[1]),fetch("/appointment/".concat(a,"/delete"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:n})}).then(function(e){return e.json()}).then(function(e){e.success?(y&&y.hide(),p&&p._isShown&&p.hide(),A(),fetch("/appointments/all").then(function(e){return e.json()}).then(function(e){0}),C("success","Termin erfolgreich gelöscht")):alert("Fehler beim Löschen.")}).catch(function(e){console.error(e),alert("Fehler beim Löschen.")})}}function K(){x(),document.querySelectorAll(".key-filter-checkbox").forEach(function(e){e.addEventListener("change",function(){w[this.value]=this.checked,x()})});var e=document.getElementById("keyManagementModal");if(e){f=new l.aF(e),document.querySelectorAll(".key-item-btn").forEach(function(e){var n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("click",function(){U(this)})});var n=document.getElementById("keyStatus");if(n){var t=n.cloneNode(!0);n.parentNode.replaceChild(t,n),t.addEventListener("change",function(){var e=document.getElementById("borrowDetails");"borrowed"===this.value?e&&(e.style.display="block"):e&&(e.style.display="none")})}var a=document.getElementById("borrowerType");if(a){var c=a.cloneNode(!0);a.parentNode.replaceChild(c,a),c.addEventListener("change",function(){if(document.querySelectorAll(".borrower-select").forEach(function(e){return e.style.display="none"}),this.value){var e=this.value+"SelectDiv",n=document.getElementById(e);n&&(n.style.display="block")}})}var i=document.getElementById("saveKeyBtn");if(i){var o=i.cloneNode(!0);i.parentNode.replaceChild(o,i),o.addEventListener("click",Z)}}}function U(e){var n=document.querySelector('.key-item-btn[data-key-id="'.concat(e,'"]'));n||(n=e);var t=n.dataset.keyId,a=n.dataset.keyName,c=n.dataset.keyStatus,i=document.getElementById("keyId");i&&(i.value=t);var o=document.getElementById("modalKeyNameTitle");o&&(o.textContent=a);var r=document.getElementById("keyStatus");r&&(r.value=c,r.dispatchEvent(new Event("change")));var l=document.getElementById("keyBorrowDate"),d=document.getElementById("keyReturnDate");if(l){var m=(0,u.qR)(l,"singleDateTime"),h=n.dataset.borrowDate;h&&m&&m.setStartDate(s()(h))}if(d){var p=(0,u.qR)(d,"singleDateTime"),v=n.dataset.returnDate;v&&p&&p.setStartDate(s()(v))}var y=n.dataset.userId,b=n.dataset.techId,g=n.dataset.prodId,k=n.dataset.cleanId,E=document.getElementById("borrowerType");if(E){var I=document.getElementById("userId");I&&(I.value="");var w=document.getElementById("technicianId");w&&(w.value="");var B=document.getElementById("productionId");B&&(B.value="");var S=document.getElementById("cleaningId");S&&(S.value=""),y&&I?(E.value="user",I.value=y):b&&w?(E.value="technician",w.value=b):g&&B?(E.value="production",B.value=g):k&&S?(E.value="cleaning",S.value=k):E.value="",E.dispatchEvent(new Event("change"))}f&&f.show()}function Z(){var e=document.getElementById("keyId"),n=document.getElementById("keyStatus");if(e&&n){var t=e.value,a=n.value,c=function(e){var n=document.getElementById(e);return n?n.value:null},i=document.getElementById("keyBorrowDate"),o=document.getElementById("keyReturnDate"),r=null,l=null;if(i){var d=(0,u.IQ)(i);d&&d.startDate&&(r=d.startDate.format("YYYY-MM-DD HH:mm:ss"))}if(o){var s=(0,u.IQ)(o);s&&s.startDate&&(l=s.startDate.format("YYYY-MM-DD HH:mm:ss"))}var m={status:a,userId:c("userId"),technicianId:c("technicianId"),productionId:c("productionId"),cleaningId:c("cleaningId"),borrowDate:r,returnDate:l};fetch("/dashboard/key/".concat(t,"/update"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}).then(function(e){e.ok?(f.hide(),window.location.reload()):alert("Fehler beim Speichern")}).catch(function(e){return console.error(e)})}}function Q(){T(),K()}window.__dashboardBound||(window.__dashboardBound=!0,document.addEventListener("DOMContentLoaded",Q),document.addEventListener("turbo:load",Q),document.addEventListener("turbo:render",Q),document.addEventListener("turbo:visit",Q))}}]);