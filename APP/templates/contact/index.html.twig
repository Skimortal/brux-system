{% extends 'base_logged_in.html.twig' %}

{% block title %}{{ 'contact.list'|trans }}{% endblock %}

{% block logged_in_content %}
    <h2 class="c-grey-900" style="margin-bottom: 10px;">
        {{ 'contact.list'|trans }}
        <div class="float-end">
            <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#contactFormModal"
                    data-contact-action="new">
                {{ 'create_new'|trans }}
            </button>
        </div>
    </h2>

    {% for label, messages in app.flashes(['success', 'danger', 'warning', 'info']) %}
        {% for message in messages %}
            <div class="alert alert-{{ label }} alert-dismissible fade show" role="alert">
                {{ message|trans }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endfor %}

    <div class="row gap-20 masonry pos-r">
        <div class="masonry-sizer col-md-6"></div>

        {% for categoryName, contacts in grouped_contacts %}
        <div class="masonry-item col-md-6">
            <div class="bgc-white p-20 bd">
                <h6 class="c-grey-900">{{ categoryName }} <span class="badge bg-secondary">{{ contacts|length }}</span></h6>
                <div class="mT-30">
                    {% if contacts|length > 0 %}
                        <div class="row">
                            {% for contact in contacts %}
                                <div class="col-sm-3">
                                    <div class="card" style="width:100%; min-height: 200px; margin-bottom: 15px;">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ contact.name }}</h5>
                                            <p class="card-text">
                                                {% if contact.company %}
                                                    <i class="ti-briefcase"></i> {{ contact.company }}<br/>
                                                {% endif %}
                                                {% if contact.email %}
                                                    <i class="ti-email text-info"></i>
                                                    <a href="mailto:{{ contact.email }}">{{ contact.email }}</a><br/>
                                                {% endif %}

                                                {% if contact.phone %}
                                                    <i class="ti-mobile text-success"></i>
                                                    <a href="tel:{{ contact.phone }}">{{ contact.phone }}</a><br/>
                                                {% endif %}

                                                {% if contact.notes %}
                                                    <i class="ti-notepad"></i> {{ contact.notes|slice(0, 50) }}{% if contact.notes|length > 50 %}...{% endif %}
                                                {% endif %}
                                            </p>


                                            <a href="{{ path('app_contact_edit', {id: contact.id}) }}" title="{{ 'edit'|trans }}">
                                                <span class="badge bg-info"><i class="ti-pencil-alt"></i></span>
                                            </a>
                                            {% if is_granted('ROLE_ADMIN') %}
                                                <a href="{{ path('app_contact_delete', {id: contact.id}) }}" class="confirmRemoveItem float-end" title="{{ 'delete'|trans }}" role="button" data-confirm="{}" data-confirm-message="{{ 'confirm_remove'|trans }}">
                                                    <span class="badge bg-danger"><i class="ti-trash"></i></span>
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                {% else %}
                    <div class="alert alert-info">
                        {{ 'contact.no_contacts'|trans }}
                    </div>
                {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if grouped_contacts|length == 0 %}
        <div class="alert alert-warning">
            {{ 'contact.no_contacts_found'|trans }}
        </div>
    {% endif %}

{% endblock %}
